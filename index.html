<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Žemėlapiai pagal metus</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    :root { --gap: 16px; }
    body { margin:0; font-family: Arial, sans-serif; background:#f6f7f9; }

    .map-area{
      position: fixed;
      left: var(--gap);
      top: var(--gap);
      right: 260px;
      bottom: var(--gap);
      background:#fff;
      border:1px solid #ddd;
      border-radius:12px;
      overflow:hidden;
    }
    #map { width:100%; height:100%; }

    .panel{
      position: fixed;
      top: var(--gap);
      right: var(--gap);
      width: 230px;
      background:#fff;
      border:1px solid #ddd;
      border-radius:12px;
      padding:14px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    }
    .panel h3 { margin:0 0 10px 0; font-size:16px; }
    select{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid #ccc; background:#fff; }
    .badge{ display:inline-block; margin-top:10px; padding:6px 10px; border-radius:999px; background:#eef2ff; border:1px solid #d9ddff; font-size:12px; }
    .note{ margin-top:10px; font-size:12px; color:#444; line-height:1.35; }

    button{
      width:100%;
      margin-top:10px;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #cfd6ff;
      background:#f2f5ff;
      cursor:pointer;
      font-weight:600;
    }

    textarea{
      width:100%;
      margin-top:10px;
      min-height:120px;
      border-radius:10px;
      border:1px solid #ddd;
      padding:10px;
      font-size:12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      resize: vertical;
    }

    @media (max-width: 820px) {
      .map-area { right: var(--gap); bottom: 240px; }
      .panel { width:auto; left: var(--gap); right: var(--gap); top:auto; bottom: var(--gap); }
    }
  </style>
</head>

<body>
  <div class="map-area"><div id="map"></div></div>

  <div class="panel">
    <h3>Metai</h3>
    <select id="yearSelect">
      <option value="2022" selected>2022</option>
      <option value="2023">2023</option>
      <option value="2024">2024</option>
      <option value="2025">2025</option>
      <option value="2026">2026</option>
    </select>

    <div class="badge" id="status">Rodomas: 2022</div>

    <button id="debugBtn">Debug: OFF</button>

    <div class="note" id="hint">
      Debug OFF: paspausk ant <b>Vilnius</b> arba <b>Kaunas</b> zonos (nematoma) – iššoks popup.
      <br><br>
      Įjunk Debug, kad “užsifiksuotum” tikslias koordinates ant JPG.
    </div>

    <textarea id="codeOut" readonly placeholder="Kai Debug ON ir paspausi kampus – čia atsiras sugeneruotos koordinatės."></textarea>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    const yearSelect = document.getElementById("yearSelect");
    const status = document.getElementById("status");
    const debugBtn = document.getElementById("debugBtn");
    const hint = document.getElementById("hint");
    const codeOut = document.getElementById("codeOut");

    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -2,
      maxZoom: 4
    });

    let overlay = null;
    let clickRegions = L.layerGroup().addTo(map);
    let debugPointsLayer = L.layerGroup().addTo(map);

    // === TAVO GALUTINĖS KOORDINATĖS ČIA (bus pakeistos po debug) ===
    let VILNIUS_TRI = [
      [80, 210],
      [80, 360],
      [340, 360]
    ];
    let KAUNAS_RECT = {
      x1: 700, y1: 245,
      x2: 900, y2: 340
    };

    let DEBUG = false;

    // Kontūrų stiliai:
    // - debug ON: matomas raudonas kontūras
    // - debug OFF: visiškai nematomas (bet paspaudžiamas)
    function getRegionStyle() {
      if (DEBUG) {
        return {
          color: "#ff0000",
          weight: 3,
          opacity: 0.9,
          fill: true,
          fillOpacity: 0.12
        };
      }
      return {
        color: "#000000",
        weight: 0,
        opacity: 0,
        fill: true,
        fillOpacity: 0
      };
    }

    function showPopup(e, title, population) {
      L.popup()
        .setLatLng(e.latlng)
        .setContent(`<b>${title}</b><br>Gyventojų sk.: ${population}`)
        .openOn(map);
    }

    function addRegionPolygon(pointsXY, title, population) {
      const latlngs = pointsXY.map(([x,y]) => [y, x]);
      const poly = L.polygon(latlngs, getRegionStyle());
      poly.on('click', (e) => showPopup(e, title, population));
      poly.addTo(clickRegions);
      return poly;
    }

    function addRegionRect(x1, y1, x2, y2, title, population) {
      const rect = L.rectangle([[y1, x1], [y2, x2]], getRegionStyle());
      rect.on('click', (e) => showPopup(e, title, population));
      rect.addTo(clickRegions);
      return rect;
    }

    function redrawRegions(year) {
      clickRegions.clearLayers();

      if (year === "2022") {
        addRegionPolygon(VILNIUS_TRI, "Vilnius", 592389);
        addRegionRect(KAUNAS_RECT.x1, KAUNAS_RECT.y1, KAUNAS_RECT.x2, KAUNAS_RECT.y2, "Kaunas", 298753);
      }
    }

    function formatCodeSnippet() {
      const tri = JSON.stringify(VILNIUS_TRI, null, 2);
      const rect = JSON.stringify(KAUNAS_RECT, null, 2);
      return `// Nukopijuok ir įklijuok į index.html (VILNIUS_TRI ir KAUNAS_RECT):
let VILNIUS_TRI = ${tri};

let KAUNAS_RECT = ${rect};`;
    }

    // === DEBUG: surinkimas kampų ===
    let vilniusClicks = [];
    let kaunasClicks = [];

    function setHintText() {
      if (!DEBUG) {
        hint.innerHTML = `
          Debug OFF: paspausk ant <b>Vilnius</b> arba <b>Kaunas</b> zonos (nematoma) – iššoks popup.
          <br><br>
          Įjunk Debug, kad “užsifiksuotum” tikslias koordinates ant JPG.
        `;
        return;
      }
      hint.innerHTML = `
        <b>Debug ON</b><br>
        1) Paspausk <b>3 kartus</b> ant Vilnius trikampio kampų.<br>
        2) Paspausk <b>2 kartus</b> ant Kaunas stačiakampio kampų (virš. kairys + apač. dešinys).<br><br>
        Koordinatės bus sugeneruotos žemiau.
      `;
    }

    function clearDebug() {
      vilniusClicks = [];
      kaunasClicks = [];
      debugPointsLayer.clearLayers();
      codeOut.value = "";
    }

    map.on('click', (e) => {
      if (!DEBUG) return;

      const x = Math.round(e.latlng.lng);
      const y = Math.round(e.latlng.lat);

      // mažas taškas, kad matytum kur paspaudei (tik debug režime)
      L.circleMarker([y, x], { radius: 4 }).addTo(debugPointsLayer);

      // Surenkam 3 Vilniui, po to 2 Kaunui
      if (vilniusClicks.length < 3) {
        vilniusClicks.push([x, y]);

        if (vilniusClicks.length === 3) {
          // atnaujinam trikampį
          VILNIUS_TRI = vilniusClicks.slice();
          redrawRegions(yearSelect.value);
          codeOut.value = formatCodeSnippet();
        }
        return;
      }

      if (kaunasClicks.length < 2) {
        kaunasClicks.push([x, y]);

        if (kaunasClicks.length === 2) {
          const [a, b] = kaunasClicks;
          const x1 = Math.min(a[0], b[0]);
          const y1 = Math.min(a[1], b[1]);
          const x2 = Math.max(a[0], b[0]);
          const y2 = Math.max(a[1], b[1]);

          KAUNAS_RECT = { x1, y1, x2, y2 };
          redrawRegions(yearSelect.value);
          codeOut.value = formatCodeSnippet();
        }
        return;
      }
    });

    debugBtn.addEventListener("click", () => {
      DEBUG = !DEBUG;
      debugBtn.textContent = `Debug: ${DEBUG ? "ON" : "OFF"}`;
      clearDebug();
      setHintText();
      redrawRegions(yearSelect.value);
    });

    async function loadYear(year) {
      status.textContent = `Rodomas: ${year}`;

      const imgUrl = `assets/${year}.jpg`;
      const img = new Image();
      img.src = imgUrl;
      await img.decode();

      const w = img.naturalWidth;
      const h = img.naturalHeight;
      const bounds = [[0,0],[h,w]];

      if (overlay) map.removeLayer(overlay);
      overlay = L.imageOverlay(imgUrl, bounds).addTo(map);
      map.fitBounds(bounds);

      // perjungus metus — nuvalom debug paspaudimus
      clearDebug();
      redrawRegions(year);
    }

    yearSelect.addEventListener("change", () => loadYear(yearSelect.value));

    setHintText();
    loadYear("2022");
  </script>
</body>
</html>
